<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lanyuan.mapper.PhysicalExaminationResultMapper">
    <!--mybatis ehcache缓存配置 -->
    <!-- 以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 <cache type="org.mybatis.caches.ehcache.LoggingEhcache"
        /> -->
    <!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->
    <!-- 以下与实体类的中字段一致 -->
    <sql id="selectId">
  cbe.id,
  cbe.custom_id,
  cbe.organization_id,
  cbe.insert_time,
  cbe.isdelete,
  cbe.last_check_time,
  ci.idcard,
  ci.vipcard,
  ci.mobile,
  ci.username,
  ci.password,
  ci.name,
  ci.sex,
  ci.birthday,
  ci.body_height,
  ci.weight,
  ci.zhiwen_code,
  ci.zhiwen_path,
  lo.name AS organization_name
	</sql>

    <select id="findEnterprisePage" resultType="com.lanyuan.entity.PhysicalExaminationResultFormMap">
        select
        <include refid="selectId" />
        FROM custom_beloneto_ent cbe
        LEFT JOIN custom_info ci
        ON ci.id = cbe.custom_id
        LEFT JOIN ly_organization lo
        ON cbe.organization_id = lo.id
        where  cbe.isdelete = 0 AND ci.isvalid = 1
        <if test="organization_id != null">
            AND  cbe.organization_id = ${organization_id}
        </if>
        <if test="insert_time_start != null">
            AND  cbe.insert_time &gt;= '${sub_point_id}'
        </if>
        <if test="insert_time_end != null">
            AND cbe.insert_time &lt;= '${insert_time_end}'
        </if>
        <if test="name != null">
            AND ci.name = '${name}'
        </if>
        <if test="orderby != null">
            ORDER BY ${orderby}
        </if>
    </select>


    <select id="findItemCheckResultList" resultType="com.lanyuan.entity.PhysicalExaminationResultFormMap">
        SELECT
        per.bit_item_id,
        per.gen_min_value,
        per.gen_max_value,
        per.gen_in_value,
        per.in_value_score,
        per.check_value,
        per.item_score,
        cpl.name AS orgin_leve_id,
        cpl.show_color AS org_show_color,
        cpl.id AS orgin_leve_id_id,
        cpl1.id AS tzed_leve_id_id,
        cpl1.name AS tzed_leve_id,
        cpl1.show_color AS tzed_show_color,
        per.gen_quanzhong,
        per.quanzhong_score,
        csi.name,
        csi.check_desc,
        csi.min_value,
        csi.max_value,
        csi.check_min,
        csi.check_max
        FROM physical_examination_result per
        LEFT JOIN check_small_item csi
        ON csi.id = per.small_item_id
        LEFT JOIN cf_pingfen_leve cpl
        ON cpl.id = per.orgin_leve_id
        LEFT JOIN cf_pingfen_leve cpl1
        ON cpl1.id = per.tzed_leve_id
        WHERE per.examination_record_id  = #{examination_record_id}
        <if test="big_item_id != null">
            AND  per.bit_item_id = #{big_item_id}
        </if>
        order by csi.id ASC
    </select>


    <insert id="insertByHistory">
  INSERT INTO physical_examination_result (examination_record_id, bit_item_id, small_item_id, gen_min_value, gen_max_value, gen_in_value, in_value_score, check_value, item_score, orgin_leve_id, gen_quanzhong, quanzhong_score, pinggu, tzed_leve_id, tzed_check_value)
  SELECT
    ${distRecordId},
    per.bit_item_id,
    per.small_item_id,
    per.gen_min_value,
    per.gen_max_value,
    per.gen_in_value,
    per.in_value_score,
    per.check_value,
    per.item_score,
    per.orgin_leve_id,
    per.gen_quanzhong,
    per.quanzhong_score,
    per.pinggu,
    per.tzed_leve_id,
    per.tzed_check_value
  FROM physical_examination_result per
  WHERE per.examination_record_id = ${sourceRecordId}
    </insert>


    <select id="resultSizeByRecordid" resultType="java.lang.Integer">
        SELECT COUNT(1) ct FROM physical_examination_result per WHERE per.examination_record_id = #{examination_record_id};
    </select>





</mapper>